function inView(e,t){var o=$("#main").offset().top,n=o+$("#main").height(),a=t.offset().top,i=a+t.height();return"up"==e?i<n:"down"==e?a>o:i<=n&&a>=o}function setYPosition(e,t){parseInt(e.css("top"),10);e.css("top",`${t}px`)}!function(){var e=window.Engine={SITE_URL:encodeURIComponent("http://adarkroom.doublespeakgames.com"),VERSION:1.3,MAX_STORE:99999999999999,SAVE_DISPLAY:3e4,GAME_OVER:!1,topics:{},Perks:{boxer:{name:_("boxer"),desc:_("punches do more damage"),notify:_("learned to throw punches with purpose")},"martial artist":{name:_("martial artist"),desc:_("punches do even more damage."),notify:_("learned to fight quite effectively without weapons")},"unarmed master":{name:_("unarmed master"),desc:_("punch twice as fast, and with even more force"),notify:_("learned to strike faster without weapons")},barbarian:{name:_("barbarian"),desc:_("melee weapons deal more damage"),notify:_("learned to swing weapons with force")},"slow metabolism":{name:_("slow metabolism"),desc:_("go twice as far without eating"),notify:_("learned how to ignore the hunger")},"desert rat":{name:_("desert rat"),desc:_("go twice as far without drinking"),notify:_("learned to love the dry air")},evasive:{name:_("evasive"),desc:_("dodge attacks more effectively"),notify:_("learned to be where they're not")},precise:{name:_("precise"),desc:_("land blows more often"),notify:_("learned to predict their movement")},scout:{name:_("scout"),desc:_("see farther"),notify:_("learned to look ahead")},stealthy:{name:_("stealthy"),desc:_("better avoid conflict in the wild"),notify:_("learned how not to be seen")},gastronome:{name:_("gastronome"),desc:_("restore more health when eating"),notify:_("learned to make the most of food")}},options:{state:null,debug:!1,log:!1,dropbox:!1,doubleTime:!1},init:function(t){for(var o in this.options=$.extend(this.options,t),this._debug=this.options.debug,this._log=this.options.log,e.browserValid()||(window.location="browserWarning.html"),e.isMobile()&&(window.location="mobileWarning.html"),e.disableSelection(),null!=this.options.state?window.State=this.options.state:e.loadGame(),AudioLibrary)(o.toString().indexOf("MUSIC_")>-1||o.toString().indexOf("EVENT_")>-1)&&AudioEngine.loadAudioFile(AudioLibrary[o]);$("<div>").attr("id","locationSlider").appendTo("#main");var a=$("<div>").addClass("menu").appendTo("body");if("undefined"!=typeof langs){var i=$("<span>").addClass("customSelect").addClass("menuBtn").appendTo(a),s=$("<span>").addClass("customSelectOptions").appendTo(i),r=$("<ul>").appendTo(s);$("<li>").text("language.").appendTo(r),$.each(langs,(function(t,o){$("<li>").text(o).attr("data-language",t).on("click",(function(){e.switchLanguage(this)})).appendTo(r)}))}$("<span>").addClass("volume menuBtn").text(_("sound on.")).click((()=>e.toggleVolume())).appendTo(a),$("<span>").addClass("appStore menuBtn").text(_("get the app.")).click(e.getApp).appendTo(a),$("<span>").addClass("lightsOff menuBtn").text(_("lights off.")).click(e.turnLightsOff).appendTo(a),$("<span>").addClass("hyper menuBtn").text(_("hyper.")).click(e.confirmHyperMode).appendTo(a),$("<span>").addClass("menuBtn").text(_("restart.")).click(e.confirmDelete).appendTo(a),$("<span>").addClass("menuBtn").text(_("share.")).click(e.share).appendTo(a),$("<span>").addClass("menuBtn").text(_("save.")).click(e.exportImport).appendTo(a),this.options.dropbox&&e.Dropbox&&(this.dropbox=e.Dropbox.init(),$("<span>").addClass("menuBtn").text(_("dropbox.")).click(e.Dropbox.startDropbox).appendTo(a)),$("<span>").addClass("menuBtn").text(_("github.")).click((function(){window.open("https://github.com/doublespeakgames/adarkroom")})).appendTo(a),$("body").off("keydown").keydown(e.keyDown),$("body").off("keyup").keyup(e.keyUp),swipeElement=$("#outerSlider"),swipeElement.on("swipeleft",e.swipeLeft),swipeElement.on("swiperight",e.swipeRight),swipeElement.on("swipeup",e.swipeUp),swipeElement.on("swipedown",e.swipeDown),$.Dispatch("stateUpdate").subscribe(e.handleStateUpdates),$SM.init(),AudioEngine.init(),Notifications.init(),Events.init(),Room.init(),void 0!==$SM.get("stores.wood")&&Outside.init(),$SM.get("stores.compass",!0)>0&&Path.init(),$SM.get("features.location.fabricator")&&Fabricator.init(),$SM.get("features.location.spaceShip")&&Ship.init(),$SM.get("config.lightsOff",!0)&&e.turnLightsOff(),$SM.get("config.hyperMode",!0)&&e.triggerHyperMode(),e.toggleVolume(Boolean($SM.get("config.soundOn"))),AudioEngine.isAudioContextRunning()||document.addEventListener("click",e.resumeAudioContext,!0),e.saveLanguage(),e.travelTo(Room),setTimeout(n,3e3)},resumeAudioContext:function(){AudioEngine.tryResumingAudioContext(),AudioEngine.setMasterVolume($SM.get("config.soundOn")?1:0,0),document.removeEventListener("click",e.resumeAudioContext)},browserValid:function(){return location.search.indexOf("ignorebrowser=true")>=0||"undefined"!=typeof Storage&&!oldIE},isMobile:function(){return location.search.indexOf("ignorebrowser=true")<0&&/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},saveGame:function(){"undefined"!=typeof Storage&&localStorage&&(null!=e._saveTimer&&clearTimeout(e._saveTimer),(void 0===e._lastNotify||Date.now()-e._lastNotify>e.SAVE_DISPLAY)&&($("#saveNotify").css("opacity",1).animate({opacity:0},1e3,"linear"),e._lastNotify=Date.now()),localStorage.gameState=JSON.stringify(State))},loadGame:function(){try{var t=JSON.parse(localStorage.gameState);t&&(State=t,$SM.updateOldState(),e.log("loaded save!"))}catch(t){State={},$SM.set("version",e.VERSION),e.event("progress","new game")}},exportImport:function(){Events.startEvent({title:_("Export / Import"),scenes:{start:{text:[_("export or import save data, for backing up"),_("or migrating computers")],buttons:{export:{text:_("export"),nextScene:{1:"inputExport"}},import:{text:_("import"),nextScene:{1:"confirm"}},cancel:{text:_("cancel"),nextScene:"end"}}},inputExport:{text:[_("save this.")],textarea:e.export64(),onLoad:function(){e.event("progress","export")},readonly:!0,buttons:{done:{text:_("got it"),nextScene:"end",onChoose:e.disableSelection}}},confirm:{text:[_("are you sure?"),_("if the code is invalid, all data will be lost."),_("this is irreversible.")],buttons:{yes:{text:_("yes"),nextScene:{1:"inputImport"},onChoose:e.enableSelection},no:{text:_("no"),nextScene:{1:"start"}}}},inputImport:{text:[_("put the save code here.")],textarea:"",buttons:{okay:{text:_("import"),nextScene:"end",onChoose:e.import64},cancel:{text:_("cancel"),nextScene:"end"}}}}})},generateExport64:function(){var e=Base64.encode(localStorage.gameState);return e=(e=(e=e.replace(/\s/g,"")).replace(/\./g,"")).replace(/\n/g,"")},export64:function(){return e.saveGame(),e.enableSelection(),e.generateExport64()},import64:function(t){e.event("progress","import"),e.disableSelection(),t=(t=(t=t.replace(/\s/g,"")).replace(/\./g,"")).replace(/\n/g,"");var o=Base64.decode(t);localStorage.gameState=o,location.reload()},event:function(e,t){"function"==typeof ga&&ga("send","event",e,t)},confirmDelete:function(){Events.startEvent({title:_("Restart?"),scenes:{start:{text:[_("restart the game?")],buttons:{yes:{text:_("yes"),nextScene:"end",onChoose:e.deleteSave},no:{text:_("no"),nextScene:"end"}}}}})},deleteSave:function(e){if("undefined"!=typeof Storage&&localStorage){var t=Prestige.get();window.State={},localStorage.clear(),Prestige.set(t)}e||location.reload()},getApp:function(){Events.startEvent({title:_("Get the App"),scenes:{start:{text:[_("bring the room with you.")],buttons:{ios:{text:_("ios"),nextScene:"end",onChoose:function(){window.open("https://itunes.apple.com/app/apple-store/id736683061?pt=2073437&ct=adrproper&mt=8")}},android:{text:_("android"),nextScene:"end",onChoose:function(){window.open("https://play.google.com/store/apps/details?id=com.yourcompany.adarkroom")}},close:{text:_("close"),nextScene:"end"}}}}})},share:function(){Events.startEvent({title:_("Share"),scenes:{start:{text:[_("bring your friends.")],buttons:{facebook:{text:_("facebook"),nextScene:"end",onChoose:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+e.SITE_URL,"sharer","width=626,height=436,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no")}},google:{text:_("google+"),nextScene:"end",onChoose:function(){window.open("https://plus.google.com/share?url="+e.SITE_URL,"sharer","width=480,height=436,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no")}},twitter:{text:_("twitter"),nextScene:"end",onChoose:function(){window.open("https://twitter.com/intent/tweet?text=A%20Dark%20Room&url="+e.SITE_URL,"sharer","width=660,height=260,location=no,menubar=no,resizable=no,scrollbars=yes,status=no,toolbar=no")}},reddit:{text:_("reddit"),nextScene:"end",onChoose:function(){window.open("http://www.reddit.com/submit?url="+e.SITE_URL,"sharer","width=960,height=700,location=no,menubar=no,resizable=no,scrollbars=yes,status=no,toolbar=no")}},close:{text:_("close"),nextScene:"end"}}}}},{width:"400px"})},findStylesheet:function(e){for(var t=0;t<document.styleSheets.length;t++){var o=document.styleSheets[t];if(o.title==e)return o}return null},isLightsOff:function(){var t=e.findStylesheet("darkenLights");return null!=t&&!t.disabled},turnLightsOff:function(){var t=e.findStylesheet("darkenLights");null==t?($("head").append('<link rel="stylesheet" href="css/dark.css" type="text/css" title="darkenLights" />'),$(".lightsOff").text(_("lights on.")),$SM.set("config.lightsOff",!0,!0)):t.disabled?(t.disabled=!1,$(".lightsOff").text(_("lights on.")),$SM.set("config.lightsOff",!0,!0)):($("#darkenLights").attr("disabled","disabled"),t.disabled=!0,$(".lightsOff").text(_("lights off.")),$SM.set("config.lightsOff",!1,!0))},confirmHyperMode:function(){e.options.doubleTime?e.triggerHyperMode():Events.startEvent({title:_("Go Hyper?"),scenes:{start:{text:[_("turning hyper mode speeds up the game to x2 speed. do you want to do that?")],buttons:{yes:{text:_("yes"),nextScene:"end",onChoose:e.triggerHyperMode},no:{text:_("no"),nextScene:"end"}}}}})},triggerHyperMode:function(){e.options.doubleTime=!e.options.doubleTime,e.options.doubleTime?$(".hyper").text(_("classic.")):$(".hyper").text(_("hyper.")),$SM.set("config.hyperMode",e.options.doubleTime,!1)},getGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},activeModule:null,travelTo:function(t){if(e.activeModule!=t){var o=e.activeModule?$(".location").index(e.activeModule.panel):1;$("div.headerButton").removeClass("selected"),t.tab.addClass("selected");var n=$("#locationSlider"),a=$("#storesContainer"),i=$(".location").index(t.panel),s=Math.abs(i-o);n.animate({left:-700*i+"px"},300*s),void 0!==$SM.get("stores.wood")&&a.animate({right:-700*i+"px"},300*s),e.activeModule!=Room&&e.activeModule!=Path&&e.activeModule!=Fabricator||t!=Room&&t!=Path&&t!=Fabricator&&$("div#weapons").animate({opacity:0},300),t!=Room&&t!=Path&&t!=Fabricator||$("div#weapons").animate({opacity:1},300),e.activeModule=t,t.onArrival(s),Notifications.printQueue(t)}},moveStoresView:function(e,t){var o=$("#storesContainer");void 0!==o&&(void 0===t&&(t=1),null===e?o.animate({top:"0px"},{queue:!1,duration:300*t}):e.length?o.animate({top:e.height()+26+"px"},{queue:!1,duration:300*t}):o.animate({top:"0px"},{queue:!1,duration:300*t}))},log:function(e){this._log&&console.log(e)},updateSlider:function(){var e=$("#locationSlider");e.width(700*e.children().length+"px")},updateOuterSlider:function(){var e=$("#outerSlider");e.width(700*e.children().length+"px")},getIncomeMsg:function(e,t){return _("{0} per {1}s",(e>0?"+":"")+e,t)},keyLock:!1,tabNavigation:!0,restoreNavigation:!1,keyDown:function(t){return t=t||window.event,e.keyPressed||e.keyLock||(e.pressed=!0,e.activeModule.keyDown&&e.activeModule.keyDown(t)),jQuery.inArray(t.keycode,[37,38,39,40])<0},keyUp:function(t){if(e.pressed=!1,e.activeModule.keyUp)e.activeModule.keyUp(t);else switch(t.which){case 38:case 87:e.log("up");break;case 40:case 83:e.log("down");break;case 37:case 65:e.tabNavigation&&(e.activeModule==Ship&&Fabricator.tab?e.travelTo(Fabricator):e.activeModule!=Ship&&e.activeModule!=Fabricator||!Path.tab?e.activeModule==Path&&Outside.tab?e.travelTo(Outside):e.activeModule==Outside&&Room.tab&&e.travelTo(Room):e.travelTo(Path)),e.log("left");break;case 39:case 68:e.tabNavigation&&(e.activeModule==Room&&Outside.tab?e.travelTo(Outside):e.activeModule==Outside&&Path.tab?e.travelTo(Path):e.activeModule==Path&&Fabricator.tab?e.travelTo(Fabricator):e.activeModule!=Path&&e.activeModule!=Fabricator||!Ship.tab||e.travelTo(Ship)),e.log("right")}return e.restoreNavigation&&(e.tabNavigation=!0,e.restoreNavigation=!1),!1},swipeLeft:function(t){e.activeModule.swipeLeft&&e.activeModule.swipeLeft(t)},swipeRight:function(t){e.activeModule.swipeRight&&e.activeModule.swipeRight(t)},swipeUp:function(t){e.activeModule.swipeUp&&e.activeModule.swipeUp(t)},swipeDown:function(t){e.activeModule.swipeDown&&e.activeModule.swipeDown(t)},disableSelection:function(){document.onselectstart=t,document.onmousedown=t},enableSelection:function(){document.onselectstart=o,document.onmousedown=o},autoSelect:function(e){$(e).focus().select()},handleStateUpdates:function(e){},switchLanguage:function(e){var t=$(e).data("language");-1!=document.location.href.search(/[\?\&]lang=[a-z_]+/)?document.location.href=document.location.href.replace(/([\?\&]lang=)([a-z_]+)/gi,"$1"+t):document.location.href=document.location.href+(-1!=document.location.href.search(/\?/)?"&":"?")+"lang="+t},saveLanguage:function(){var e=decodeURIComponent((new RegExp("[?|&]lang=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null;e&&"undefined"!=typeof Storage&&localStorage&&(localStorage.lang=e)},toggleVolume:function(e){null==e&&(e=!$SM.get("config.soundOn")),e?($(".volume").text(_("sound off.")),$SM.set("config.soundOn",!0),AudioEngine.setMasterVolume(1)):($(".volume").text(_("sound on.")),$SM.set("config.soundOn",!1),AudioEngine.setMasterVolume(0))},setInterval:function(t,o,n){return e.options.doubleTime&&!n&&(e.log("Double time, cutting interval in half"),o/=2),setInterval(t,o)},setTimeout:function(t,o,n){return e.options.doubleTime&&!n&&(e.log("Double time, cutting timeout in half"),o/=2),setTimeout(t,o)}};function t(e){return $(e.target).hasClass("menuBtn")}function o(e){return!0}function n(){$SM.get("playStats.audioAlertShown")||($SM.set("playStats.audioAlertShown",!0),Events.startEvent({title:_("Sound Available!"),scenes:{start:{text:[_("ears flooded with new sensations."),_("perhaps silence is safer?")],buttons:{yes:{text:_("enable audio"),nextScene:"end",onChoose:()=>e.toggleVolume(!0)},no:{text:_("disable audio"),nextScene:"end",onChoose:()=>e.toggleVolume(!1)}}}}}))}}(),$.Dispatch=function(e){var t,o=e&&Engine.topics[e];return o||(o={publish:(t=jQuery.Callbacks()).fire,subscribe:t.add,unsubscribe:t.remove},e&&(Engine.topics[e]=o)),o},$((function(){Engine.init()}));