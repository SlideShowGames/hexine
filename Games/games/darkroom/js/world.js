var World={RADIUS:30,VILLAGE_POS:[30,30],TILE:{VILLAGE:"A",IRON_MINE:"I",COAL_MINE:"C",SULPHUR_MINE:"S",FOREST:";",FIELD:",",BARRENS:".",ROAD:"#",HOUSE:"H",CAVE:"V",TOWN:"O",CITY:"Y",OUTPOST:"P",SHIP:"W",BOREHOLE:"B",BATTLEFIELD:"F",SWAMP:"M",CACHE:"U",EXECUTIONER:"X"},TILE_PROBS:{},LANDMARKS:{},STICKINESS:.5,LIGHT_RADIUS:2,BASE_WATER:10,MOVES_PER_FOOD:2,MOVES_PER_WATER:1,DEATH_COOLDOWN:120,FIGHT_CHANCE:.2,BASE_HEALTH:10,BASE_HIT_CHANCE:.8,MEAT_HEAL:8,MEDS_HEAL:20,HYPO_HEAL:30,FIGHT_DELAY:3,NORTH:[0,-1],SOUTH:[0,1],WEST:[-1,0],EAST:[1,0],Weapons:{fists:{verb:_("punch"),type:"unarmed",damage:1,cooldown:2},"bone spear":{verb:_("stab"),type:"melee",damage:2,cooldown:2},"iron sword":{verb:_("swing"),type:"melee",damage:4,cooldown:2},"steel sword":{verb:_("slash"),type:"melee",damage:6,cooldown:2},bayonet:{verb:_("thrust"),type:"melee",damage:8,cooldown:2},rifle:{verb:_("shoot"),type:"ranged",damage:5,cooldown:1,cost:{bullets:1}},"laser rifle":{verb:_("blast"),type:"ranged",damage:8,cooldown:1,cost:{"energy cell":1}},grenade:{verb:_("lob"),type:"ranged",damage:15,cooldown:5,cost:{grenade:1}},bolas:{verb:_("tangle"),type:"ranged",damage:"stun",cooldown:15,cost:{bolas:1}},"plasma rifle":{verb:_("disintigrate"),type:"ranged",damage:12,cooldown:1,cost:{"energy cell":1}},"energy blade":{verb:_("slice"),type:"melee",damage:10,cooldown:2},disruptor:{verb:_("stun"),type:"ranged",damage:"stun",cooldown:15}},name:"World",options:{},init:function(r){if(this.options=$.extend(this.options,r),World.TILE_PROBS[World.TILE.FOREST]=.15,World.TILE_PROBS[World.TILE.FIELD]=.35,World.TILE_PROBS[World.TILE.BARRENS]=.5,World.LANDMARKS[World.TILE.OUTPOST]={num:0,minRadius:0,maxRadius:0,scene:"outpost",label:_("An&nbsp;Outpost")},World.LANDMARKS[World.TILE.IRON_MINE]={num:1,minRadius:5,maxRadius:5,scene:"ironmine",label:_("Iron&nbsp;Mine")},World.LANDMARKS[World.TILE.COAL_MINE]={num:1,minRadius:10,maxRadius:10,scene:"coalmine",label:_("Coal&nbsp;Mine")},World.LANDMARKS[World.TILE.SULPHUR_MINE]={num:1,minRadius:20,maxRadius:20,scene:"sulphurmine",label:_("Sulphur&nbsp;Mine")},World.LANDMARKS[World.TILE.HOUSE]={num:10,minRadius:0,maxRadius:1.5*World.RADIUS,scene:"house",label:_("An&nbsp;Old&nbsp;House")},World.LANDMARKS[World.TILE.CAVE]={num:5,minRadius:3,maxRadius:10,scene:"cave",label:_("A&nbsp;Damp&nbsp;Cave")},World.LANDMARKS[World.TILE.TOWN]={num:10,minRadius:10,maxRadius:20,scene:"town",label:_("An&nbsp;Abandoned&nbsp;Town")},World.LANDMARKS[World.TILE.CITY]={num:20,minRadius:20,maxRadius:1.5*World.RADIUS,scene:"city",label:_("A&nbsp;Ruined&nbsp;City")},World.LANDMARKS[World.TILE.SHIP]={num:1,minRadius:28,maxRadius:28,scene:"ship",label:_("A&nbsp;Crashed&nbsp;Starship")},World.LANDMARKS[World.TILE.BOREHOLE]={num:10,minRadius:15,maxRadius:1.5*World.RADIUS,scene:"borehole",label:_("A&nbsp;Borehole")},World.LANDMARKS[World.TILE.BATTLEFIELD]={num:5,minRadius:18,maxRadius:1.5*World.RADIUS,scene:"battlefield",label:_("A&nbsp;Battlefield")},World.LANDMARKS[World.TILE.SWAMP]={num:1,minRadius:15,maxRadius:1.5*World.RADIUS,scene:"swamp",label:_("A&nbsp;Murky&nbsp;Swamp")},World.LANDMARKS[World.TILE.EXECUTIONER]={num:1,minRadius:28,maxRadius:28,scene:"executioner",label:_("A&nbsp;Ravaged&nbsp;Battleship")},$SM.get("previous.stores")&&(World.LANDMARKS[World.TILE.CACHE]={num:1,minRadius:10,maxRadius:1.5*World.RADIUS,scene:"cache",label:_("A&nbsp;Destroyed&nbsp;Village")}),void 0===$SM.get("features.location.world"))$SM.set("features.location.world",!0),$SM.set("features.executioner",!0),$SM.setM("game.world",{map:World.generateMap(),mask:World.newMask()});else if(!$SM.get("features.executioner")){const r=$SM.get("game.world.map"),e=World.LANDMARKS[World.TILE.EXECUTIONER];for(let o=0;o<e.num;o++)World.placeLandmark(e.minRadius,e.maxRadius,World.TILE.EXECUTIONER,r);$SM.set("game.world.map",r),$SM.set("features.executioner",!0)}this.panel=$("<div>").attr("id","worldPanel").addClass("location").appendTo("#outerSlider");var e=$("<div>").attr("id","worldOuter").appendTo(this.panel);$("<div>").attr("id","bagspace-world").append($("<div>")).appendTo(e),$("<div>").attr("id","backpackTitle").appendTo(e),$("<div>").attr("id","backpackSpace").appendTo(e),$("<div>").attr("id","healthCounter").appendTo(e),Engine.updateOuterSlider(),World.ship=World.mapSearch(World.TILE.SHIP,$SM.get("game.world.map"),1),World.dir=World.compassDir(World.ship[0]),Room.compassTooltip(World.dir),World.testMap(),$.Dispatch("stateUpdate").subscribe(World.handleStateUpdates)},clearDungeon:function(){Engine.event("progress","dungeon cleared"),World.state.map[World.curPos[0]][World.curPos[1]]=World.TILE.OUTPOST,World.drawRoad()},drawRoad:function(){var r,e,o=function(r){for(var e,o,t,a=0,l=0,d=1,n=-1,s=0;s<Math.pow(World.getDistance(r,World.VILLAGE_POS)+2,2);s++){if(e=r[0]+a,o=r[1]+l,0<e&&e<2*World.RADIUS&&0<o&&o<2*World.RADIUS){var i=World.state.map[e][o];if(i===World.TILE.ROAD||i===World.TILE.OUTPOST&&(0!==a||0!==l)||i===World.TILE.VILLAGE)return[e,o]}0!==a&&0!==l||(t=d,d=-n,n=t),0===a&&l<=0?a++:(a+=d,l+=n)}return World.VILLAGE_POS}(World.curPos),t=World.curPos[0]-o[0],a=World.curPos[1]-o[1],l=Math.abs(t)/t,d=Math.abs(a)/a;Math.abs(t)>Math.abs(a)?(r=o[0],e=o[1]+a):(r=o[0]+t,e=o[1]);for(var n=0;n<Math.abs(t);n++)World.isTerrain(World.state.map[o[0]+l*n][e])&&(World.state.map[o[0]+l*n][e]=World.TILE.ROAD);for(var s=0;s<Math.abs(a);s++)World.isTerrain(World.state.map[r][o[1]+d*s])&&(World.state.map[r][o[1]+d*s]=World.TILE.ROAD);World.drawMap()},updateSupplies:function(){var r=$("div#bagspace-world > div");Path.outfit||(Path.outfit={});var e=$("div#supply_water");World.water>0&&0===e.length?(e=World.createItemDiv("water",World.water)).prependTo(r):World.water>0?$("div#supply_water",r).text(_("water:{0}",World.water)):e.remove();var o=0;for(var t in Path.outfit){var a=$("div#supply_"+t.replace(" ","-"),r),l=Path.outfit[t];o+=l*Path.getWeight(t),l>0&&0===a.length?(a=World.createItemDiv(t,l),"cured meat"==t&&World.water>0?a.insertAfter(e):"cured meat"==t?a.prependTo(r):a.appendTo(r)):l>0?$("div#"+a.attr("id"),r).text(_(t)+":"+l):a.remove()}var d=_("pockets");$SM.get("stores.rucksack",!0)>0&&(d=_("rucksack")),$("#backpackTitle").text(d),$("#backpackSpace").text(_("free {0}/{1}",Math.floor(Path.getCapacity()-o),Path.getCapacity()))},setWater:function(r){World.water=r,World.water>World.getMaxWater()&&(World.water=World.getMaxWater()),World.updateSupplies()},setHp:function(r){"number"!=typeof r||isNaN(r)||(World.health=r,World.health>World.getMaxHealth()&&(World.health=World.getMaxHealth()),$("#healthCounter").text(_("hp: {0}/{1}",World.health,World.getMaxHealth())))},createItemDiv:function(r,e){return $("<div>").attr("id","supply_"+r.replace(" ","-")).addClass("supplyItem").text(_("{0}:{1}",_(r),e))},moveNorth:function(){Engine.log("North"),World.curPos[1]>0&&World.move(World.NORTH)},moveSouth:function(){Engine.log("South"),World.curPos[1]<2*World.RADIUS&&World.move(World.SOUTH)},moveWest:function(){Engine.log("West"),World.curPos[0]>0&&World.move(World.WEST)},moveEast:function(){Engine.log("East"),World.curPos[0]<2*World.RADIUS&&World.move(World.EAST)},move:function(r){var e=World.state.map[World.curPos[0]][World.curPos[1]];World.curPos[0]+=r[0],World.curPos[1]+=r[1],World.narrateMove(e,World.state.map[World.curPos[0]][World.curPos[1]]),World.lightMap(World.curPos[0],World.curPos[1],World.state.mask),World.drawMap(),World.doSpace();var o=Math.floor(5*Math.random())+1;AudioEngine.playSound(AudioLibrary["FOOTSTEPS_"+o]),World.checkDanger()&&(World.danger?Notifications.notify(World,_("dangerous to be this far from the village without proper protection")):Notifications.notify(World,_("safer here")))},keyDown:function(r){switch(r.which){case 38:case 87:World.moveNorth();break;case 40:case 83:World.moveSouth();break;case 37:case 65:World.moveWest();break;case 39:case 68:World.moveEast()}},swipeLeft:function(r){World.moveWest()},swipeRight:function(r){World.moveEast()},swipeUp:function(r){World.moveNorth()},swipeDown:function(r){World.moveSouth()},click:function(r){var e=$("#map"),o=e.offset().left+e.width()*World.curPos[0]/(2*World.RADIUS),t=e.offset().top+e.height()*World.curPos[1]/(2*World.RADIUS),a=r.pageX-o,l=r.pageY-t;a>l&&a<-l&&World.moveNorth(),a<l&&a>-l&&World.moveSouth(),a<l&&a<-l&&World.moveWest(),a>l&&a>-l&&World.moveEast()},checkDanger:function(){if(World.danger=void 0!==World.danger&&World.danger,World.danger){if(World.getDistance()<8)return World.danger=!1,!0;if(World.getDistance<18&&$SM.get('stores["i armour"]',!0)>0)return World.danger=!1,!0}else{if(0===$SM.get('stores["i armour"]',!0)&&World.getDistance()>=8)return World.danger=!0,!0;if(0===$SM.get('stores["s armour"]',!0)&&World.getDistance()>=18)return World.danger=!0,!0}return!1},useSupplies:function(){World.foodMove++,World.waterMove++;var r=World.MOVES_PER_FOOD;if(r*=$SM.hasPerk("slow metabolism")?2:1,World.foodMove>=r){World.foodMove=0;var e=Path.outfit["cured meat"];if(0===--e)Notifications.notify(World,_("the meat has run out"));else if(e<0){if(e=0,World.starvation)return $SM.set("character.starved",$SM.get("character.starved",!0)),$SM.add("character.starved",1),$SM.get("character.starved")>=10&&!$SM.hasPerk("slow metabolism")&&$SM.addPerk("slow metabolism"),World.die(),!1;Notifications.notify(World,_("starvation sets in")),World.starvation=!0}else World.starvation=!1,World.setHp(World.health+World.meatHeal());Path.outfit["cured meat"]=e}var o=World.MOVES_PER_WATER;if(o*=$SM.hasPerk("desert rat")?2:1,World.waterMove>=o){World.waterMove=0;var t=World.water;if(0===--t)Notifications.notify(World,_("there is no more water"));else if(t<0){if(t=0,World.thirst)return $SM.set("character.dehydrated",$SM.get("character.dehydrated",!0)),$SM.add("character.dehydrated",1),$SM.get("character.dehydrated")>=10&&!$SM.hasPerk("desert rat")&&$SM.addPerk("desert rat"),World.die(),!1;Notifications.notify(World,_("the thirst becomes unbearable")),World.thirst=!0}else World.thirst=!1;World.setWater(t),World.updateSupplies()}return!0},meatHeal:function(){return World.MEAT_HEAL*($SM.hasPerk("gastronome")?2:1)},medsHeal:function(){return World.MEDS_HEAL},hypoHeal:()=>World.HYPO_HEAL,checkFight:function(){if(World.fightMove="number"==typeof World.fightMove?World.fightMove:0,World.fightMove++,World.fightMove>World.FIGHT_DELAY){var r=World.FIGHT_CHANCE;r*=$SM.hasPerk("stealthy")?.5:1,Math.random()<r&&(World.fightMove=0,Events.triggerFight())}},doSpace:function(){var r=World.state.map[World.curPos[0]][World.curPos[1]];if(r==World.TILE.VILLAGE)World.goHome();else if(r===World.TILE.EXECUTIONER){const r=World.state.executioner?"executioner-antechamber":"executioner-intro",e=Events.Executioner[r];Events.startEvent(e)}else void 0!==World.LANDMARKS[r]?r==World.TILE.OUTPOST&&World.outpostUsed()||Events.startEvent(Events.Setpieces[World.LANDMARKS[r].scene]):World.useSupplies()&&World.checkFight()},getDistance:function(r,e){return r=r||World.curPos,e=e||World.VILLAGE_POS,Math.abs(r[0]-e[0])+Math.abs(r[1]-e[1])},getTerrain:function(){return World.state.map[World.curPos[0]][World.curPos[1]]},getDamage:function(r){return World.Weapons[r].damage},narrateMove:function(r,e){var o=null;switch(r){case World.TILE.FOREST:switch(e){case World.TILE.FIELD:o=_("the trees yield to dry grass. the yellowed brush rustles in the wind.");break;case World.TILE.BARRENS:o=_("the trees are gone. parched earth and blowing dust are poor replacements.")}break;case World.TILE.FIELD:switch(e){case World.TILE.FOREST:o=_("trees loom on the horizon. grasses gradually yield to a forest floor of dry branches and fallen leaves.");break;case World.TILE.BARRENS:o=_("the grasses thin. soon, only dust remains.")}break;case World.TILE.BARRENS:switch(e){case World.TILE.FIELD:o=_("the barrens break at a sea of dying grass, swaying in the arid breeze.");break;case World.TILE.FOREST:o=_("a wall of gnarled trees rises from the dust. their branches twist into a skeletal canopy overhead.")}}null!=o&&Notifications.notify(World,o)},newMask:function(){for(var r=new Array(2*World.RADIUS+1),e=0;e<=2*World.RADIUS;e++)r[e]=new Array(2*World.RADIUS+1);return World.lightMap(World.RADIUS,World.RADIUS,r),r},lightMap:function(r,e,o){var t=World.LIGHT_RADIUS;return t*=$SM.hasPerk("scout")?2:1,World.uncoverMap(r,e,t,o),o},uncoverMap:function(r,e,o,t){t[r][e]=!0;for(var a=-o;a<=o;a++)for(var l=-o+Math.abs(a);l<=o-Math.abs(a);l++)e+l>=0&&e+l<=2*World.RADIUS&&r+a<=2*World.RADIUS&&r+a>=0&&(t[r+a][e+l]=!0)},testMap:function(){if(!World.seenAll){var r,e=$SM.get("game.world.mask");r:for(var o=0;o<e.length;o++)for(var t=0;t<e[o].length;t++)if(!e[o][t]){r=!0;break r}World.seenAll=!r}},applyMap:function(){if(!World.seenAll){var r,e,o=$SM.get("game.world.mask");do{r=Math.floor(Math.random()*(2*World.RADIUS+1)),e=Math.floor(Math.random()*(2*World.RADIUS+1))}while(o[r][e]);World.uncoverMap(r,e,5,o)}World.testMap()},generateMap:function(){for(var r=new Array(2*World.RADIUS+1),e=0;e<=2*World.RADIUS;e++)r[e]=new Array(2*World.RADIUS+1);r[World.RADIUS][World.RADIUS]=World.TILE.VILLAGE;for(var o=1;o<=World.RADIUS;o++)for(var t=0;t<8*o;t++){var a,l;t<2*o?(a=World.RADIUS-o+t,l=World.RADIUS-o):t<4*o?(a=World.RADIUS+o,l=World.RADIUS-3*o+t):t<6*o?(a=World.RADIUS+5*o-t,l=World.RADIUS+o):(a=World.RADIUS-o,l=World.RADIUS+7*o-t),r[a][l]=World.chooseTile(a,l,r)}for(var d in World.LANDMARKS)for(var n=World.LANDMARKS[d],s=0;s<n.num;s++)World.placeLandmark(n.minRadius,n.maxRadius,d,r);return r},mapSearch:function(r,e,o){var t=World.LANDMARKS[r].num;if(!t)return null;t=o?Math.min(o,t):t;var a=0,l=[];r:for(var d=0;d<=2*World.RADIUS;d++)for(var n=0;n<=2*World.RADIUS;n++)if(e[d][n].charAt(0)===r&&(l[a]={x:d-World.RADIUS,y:n-World.RADIUS},++a===t))break r;return l},compassDir:function(r){var e=r.x<0?"west":"east",o=r.y<0?"north":"south";return Math.abs(r.x)/2>Math.abs(r.y)?e:Math.abs(r.y)/2>Math.abs(r.x)?o:o+e},placeLandmark:function(r,e,o,t){for(var a=World.RADIUS,l=World.RADIUS;!World.isTerrain(t[a][l]);){var d=Math.floor(Math.random()*(e-r))+r,n=Math.floor(Math.random()*d),s=d-n;Math.random()<.5&&(n=-n),Math.random()<.5&&(s=-s),(a=World.RADIUS+n)<0&&(a=0),a>2*World.RADIUS&&(a=2*World.RADIUS),(l=World.RADIUS+s)<0&&(l=0),l>2*World.RADIUS&&(l=2*World.RADIUS)}return t[a][l]=o,[a,l]},isTerrain:function(r){return r==World.TILE.FOREST||r==World.TILE.FIELD||r==World.TILE.BARRENS},chooseTile:function(r,e,o){var t,a=[e>0?o[r][e-1]:null,e<2*World.RADIUS?o[r][e+1]:null,r<2*World.RADIUS?o[r+1][e]:null,r>0?o[r-1][e]:null],l={},d=1;for(var n in a){if(a[n]==World.TILE.VILLAGE)return World.TILE.FOREST;"string"==typeof a[n]&&(t="number"==typeof(t=l[a[n]])?t:0,l[a[n]]=t+World.STICKINESS,d-=World.STICKINESS)}for(var s in World.TILE){var i=World.TILE[s];World.isTerrain(i)&&(t="number"==typeof(t=l[i])?t:0,t+=World.TILE_PROBS[i]*d,l[i]=t)}var W=[];for(var u in l)W.push(l[u]+""+u);W.sort((function(r,e){var o=parseFloat(r.substring(0,r.length-1));return parseFloat(e.substring(0,e.length-1))-o}));var c=0,p=Math.random();for(var m in W){var S=W[m];if(p<(c+=parseFloat(S.substring(0,S.length-1))))return S.charAt(S.length-1)}return World.TILE.BARRENS},markVisited:function(r,e){World.state.map[r][e]=World.state.map[r][e]+"!"},drawMap:function(){var r=$("#map");0===r.length&&(r=new $("<div>").attr("id","map").appendTo("#worldOuter")).click(World.click);for(var e="",o=0;o<=2*World.RADIUS;o++){for(var t=0;t<=2*World.RADIUS;t++){var a="";if(t>World.RADIUS?a+=" left":a+=" right",o>World.RADIUS?a+=" top":a+=" bottom",World.curPos[0]==t&&World.curPos[1]==o)e+='<span class="landmark">@<div class="tooltip '+a+'">'+_("Wanderer")+"</div></span>";else if(World.state.mask[t][o]){var l=World.state.map[t][o];switch(l){case World.TILE.VILLAGE:e+='<span class="landmark">'+l+'<div class="tooltip'+a+'">'+_("The&nbsp;Village")+"</div></span>";break;default:void 0===World.LANDMARKS[l]||l==World.TILE.OUTPOST&&World.outpostUsed(t,o)?(l.length>1&&(l=l[0]),e+=l):e+='<span class="landmark">'+l+'<div class="tooltip'+a+'">'+World.LANDMARKS[l].label+"</div></span>"}}else e+="&nbsp;"}e+="<br/>"}r.html(e)},die:function(){World.dead||(World.dead=!0,Engine.log("player death"),Engine.event("game event","death"),Engine.keyLock=!0,Notifications.notify(World,_("the world fades")),World.state=null,Path.outfit={},$SM.remove("outfit"),AudioEngine.playSound(AudioLibrary.DEATH),$("#outerSlider").animate({opacity:"0"},600,"linear",(function(){$("#outerSlider").css("left","0px"),$("#locationSlider").css("left","0px"),$("#storesContainer").css({top:"0px",right:"0px"}),Engine.activeModule=Room,$("div.headerButton").removeClass("selected"),Room.tab.addClass("selected"),Engine.setTimeout((function(){Room.onArrival(),$("#outerSlider").animate({opacity:"1"},600,"linear"),Button.cooldown($("#embarkButton")),Engine.keyLock=!1,Engine.tabNavigation=!0}),2e3,!0)})))},goHome:function(){$SM.setM("game.world",World.state),World.testMap(),World.state.sulphurmine&&0===$SM.get('game.buildings["sulphur mine"]',!0)&&($SM.add('game.buildings["sulphur mine"]',1),Engine.event("progress","sulphur mine")),World.state.ironmine&&0===$SM.get('game.buildings["iron mine"]',!0)&&($SM.add('game.buildings["iron mine"]',1),Engine.event("progress","iron mine")),World.state.coalmine&&0===$SM.get('game.buildings["coal mine"]',!0)&&($SM.add('game.buildings["coal mine"]',1),Engine.event("progress","coal mine")),World.state.ship&&!$SM.get("features.location.spaceShip")&&(Ship.init(),Engine.event("progress","ship")),World.state.executioner&&!$SM.get("features.location.fabricator")&&(Fabricator.init(),Notifications.notify(null,_("builder knows the strange device when she sees it. takes it for herself real quick. doesn’t ask where it came from.")),Engine.event("progress","fabricator")),World.redeemBlueprints(),World.state=null,Path.outfit["cured meat"]>0&&Button.setDisabled($("#embarkButton"),!1),World.returnOutfit(),$("#outerSlider").animate({left:"0px"},300),Engine.activeModule=Path,Path.onArrival(),Engine.restoreNavigation=!0},redeemBlueprints:()=>{let r=!1;const e=(e,o)=>{Path.outfit[e]&&($SM.set(`character.blueprints['${o}']`,!0),delete Path.outfit[e],r=!0)};e("hypo blueprint","hypo"),e("kinetic armour blueprint","kinetic armour"),e("disruptor blueprint","disruptor"),e("plasma rifle blueprint","plasma rifle"),e("stim blueprint","stim"),e("glowstone blueprint","glowstone"),r&&Notifications.notify(null,"blueprints feed into the fabricator data port. possibilities grow.")},returnOutfit:()=>{for(var r in Path.outfit)$SM.add('stores["'+r+'"]',Path.outfit[r]),World.leaveItAtHome(r)&&(Path.outfit[r]=0)},leaveItAtHome:function(r){return"cured meat"!=r&&"bullets"!=r&&"energy cell"!=r&&"charm"!=r&&"medicine"!=r&&"stim"!=r&&"hypo"!=r&&void 0===World.Weapons[r]&&void 0===Room.Craftables[r]},getMaxHealth:function(){return $SM.get('stores["kinetic armour"]',!0)>0?World.BASE_HEALTH+75:$SM.get('stores["s armour"]',!0)>0?World.BASE_HEALTH+35:$SM.get('stores["i armour"]',!0)>0?World.BASE_HEALTH+15:$SM.get('stores["l armour"]',!0)>0?World.BASE_HEALTH+5:World.BASE_HEALTH},getHitChance:function(){return $SM.hasPerk("precise")?World.BASE_HIT_CHANCE+.1:World.BASE_HIT_CHANCE},getMaxWater:function(){return $SM.get('stores["fluid recycler"]',!0)>0?World.BASE_WATER+100:$SM.get('stores["water tank"]',!0)>0?World.BASE_WATER+50:$SM.get("stores.cask",!0)>0?World.BASE_WATER+20:$SM.get("stores.waterskin",!0)>0?World.BASE_WATER+10:World.BASE_WATER},outpostUsed:function(r,e){r="number"==typeof r?r:World.curPos[0],e="number"==typeof e?e:World.curPos[1];var o=World.usedOutposts[r+","+e];return void 0!==o&&!0===o},useOutpost:function(){Notifications.notify(null,_("water replenished")),World.setWater(World.getMaxWater()),World.usedOutposts[World.curPos[0]+","+World.curPos[1]]=!0},onArrival:function(){Engine.tabNavigation=!1,Button.clearCooldown($("#embarkButton")),Engine.keyLock=!1,World.state=$.extend(!0,{},$SM.get("game.world")),World.setWater(World.getMaxWater()),World.setHp(World.getMaxHealth()),World.foodMove=0,World.waterMove=0,World.starvation=!1,World.thirst=!1,World.usedOutposts={},World.curPos=World.copyPos(World.VILLAGE_POS),World.drawMap(),World.setTitle(),AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_WORLD),World.dead=!1,$("div#bagspace-world > div").empty(),World.updateSupplies(),$("#bagspace-world").width($("#map").width())},setTitle:function(){document.title=_("A Barren World")},copyPos:function(r){return[r[0],r[1]]},handleStateUpdates:function(r){}};