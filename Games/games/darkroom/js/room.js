var Room={_FIRE_COOL_DELAY:3e5,_ROOM_WARM_DELAY:3e4,_BUILDER_STATE_DELAY:3e4,_STOKE_COOLDOWN:10,_NEED_WOOD_DELAY:15e3,buttons:{},Craftables:{trap:{name:_("trap"),button:null,maximum:10,availableMsg:_("builder says she can make traps to catch any creatures might still be alive out there"),buildMsg:_("more traps to catch more creatures"),maxMsg:_("more traps won't help now"),type:"building",cost:function(){return{wood:10+10*$SM.get('game.buildings["trap"]',!0)}},audio:AudioLibrary.BUILD_TRAP},cart:{name:_("cart"),button:null,maximum:1,availableMsg:_("builder says she can make a cart for carrying wood"),buildMsg:_("the rickety cart will carry more wood from the forest"),type:"building",cost:function(){return{wood:30}},audio:AudioLibrary.BUILD_CART},hut:{name:_("hut"),button:null,maximum:20,availableMsg:_("builder says there are more wanderers. says they'll work, too."),buildMsg:_("builder puts up a hut, out in the forest. says word will get around."),maxMsg:_("no more room for huts."),type:"building",cost:function(){return{wood:100+50*$SM.get('game.buildings["hut"]',!0)}},audio:AudioLibrary.BUILD_HUT},lodge:{name:_("lodge"),button:null,maximum:1,availableMsg:_("villagers could help hunt, given the means"),buildMsg:_("the hunting lodge stands in the forest, a ways out of town"),type:"building",cost:function(){return{wood:200,fur:10,meat:5}},audio:AudioLibrary.BUILD_LODGE},"trading post":{name:_("trading post"),button:null,maximum:1,availableMsg:_("a trading post would make commerce easier"),buildMsg:_("now the nomads have a place to set up shop, they might stick around a while"),type:"building",cost:function(){return{wood:400,fur:100}},audio:AudioLibrary.BUILD_TRADING_POST},tannery:{name:_("tannery"),button:null,maximum:1,availableMsg:_("builder says leather could be useful. says the villagers could make it."),buildMsg:_("tannery goes up quick, on the edge of the village"),type:"building",cost:function(){return{wood:500,fur:50}},audio:AudioLibrary.BUILD_TANNERY},smokehouse:{name:_("smokehouse"),button:null,maximum:1,availableMsg:_("should cure the meat, or it'll spoil. builder says she can fix something up."),buildMsg:_("builder finishes the smokehouse. she looks hungry."),type:"building",cost:function(){return{wood:600,meat:50}},audio:AudioLibrary.BUILD_SMOKEHOUSE},workshop:{name:_("workshop"),button:null,maximum:1,availableMsg:_("builder says she could make finer things, if she had the tools"),buildMsg:_("workshop's finally ready. builder's excited to get to it"),type:"building",cost:function(){return{wood:800,leather:100,scales:10}},audio:AudioLibrary.BUILD_WORKSHOP},steelworks:{name:_("steelworks"),button:null,maximum:1,availableMsg:_("builder says the villagers could make steel, given the tools"),buildMsg:_("a haze falls over the village as the steelworks fires up"),type:"building",cost:function(){return{wood:1500,iron:100,coal:100}},audio:AudioLibrary.BUILD_STEELWORKS},armoury:{name:_("armoury"),button:null,maximum:1,availableMsg:_("builder says it'd be useful to have a steady source of bullets"),buildMsg:_("armoury's done, welcoming back the weapons of the past."),type:"building",cost:function(){return{wood:3e3,steel:100,sulphur:50}},audio:AudioLibrary.BUILD_ARMOURY},torch:{name:_("torch"),button:null,type:"tool",buildMsg:_("a torch to keep the dark away"),cost:function(){return{wood:1,cloth:1}},audio:AudioLibrary.CRAFT_TORCH},waterskin:{name:_("waterskin"),button:null,type:"upgrade",maximum:1,buildMsg:_("this waterskin'll hold a bit of water, at least"),cost:function(){return{leather:50}},audio:AudioLibrary.CRAFT_WATERSKIN},cask:{name:_("cask"),button:null,type:"upgrade",maximum:1,buildMsg:_("the cask holds enough water for longer expeditions"),cost:function(){return{leather:100,iron:20}},audio:AudioLibrary.CRAFT_CASK},"water tank":{name:_("water tank"),button:null,type:"upgrade",maximum:1,buildMsg:_("never go thirsty again"),cost:function(){return{iron:100,steel:50}},audio:AudioLibrary.CRAFT_WATER_TANK},"bone spear":{name:_("bone spear"),button:null,type:"weapon",buildMsg:_("this spear's not elegant, but it's pretty good at stabbing"),cost:function(){return{wood:100,teeth:5}},audio:AudioLibrary.CRAFT_BONE_SPEAR},rucksack:{name:_("rucksack"),button:null,type:"upgrade",maximum:1,buildMsg:_("carrying more means longer expeditions to the wilds"),cost:function(){return{leather:200}},audio:AudioLibrary.CRAFT_RUCKSACK},wagon:{name:_("wagon"),button:null,type:"upgrade",maximum:1,buildMsg:_("the wagon can carry a lot of supplies"),cost:function(){return{wood:500,iron:100}},audio:AudioLibrary.CRAFT_WAGON},convoy:{name:_("convoy"),button:null,type:"upgrade",maximum:1,buildMsg:_("the convoy can haul mostly everything"),cost:function(){return{wood:1e3,iron:200,steel:100}},audio:AudioLibrary.CRAFT_CONVOY},"l armour":{name:_("l armour"),type:"upgrade",maximum:1,buildMsg:_("leather's not strong. better than rags, though."),cost:function(){return{leather:200,scales:20}},audio:AudioLibrary.CRAFT_LEATHER_ARMOUR},"i armour":{name:_("i armour"),type:"upgrade",maximum:1,buildMsg:_("iron's stronger than leather"),cost:function(){return{leather:200,iron:100}},audio:AudioLibrary.CRAFT_IRON_ARMOUR},"s armour":{name:_("s armour"),type:"upgrade",maximum:1,buildMsg:_("steel's stronger than iron"),cost:function(){return{leather:200,steel:100}},audio:AudioLibrary.CRAFT_STEEL_ARMOUR},"iron sword":{name:_("iron sword"),button:null,type:"weapon",buildMsg:_("sword is sharp. good protection out in the wilds."),cost:function(){return{wood:200,leather:50,iron:20}},audio:AudioLibrary.CRAFT_IRON_SWORD},"steel sword":{name:_("steel sword"),button:null,type:"weapon",buildMsg:_("the steel is strong, and the blade true."),cost:function(){return{wood:500,leather:100,steel:20}},audio:AudioLibrary.CRAFT_STEEL_SWORD},rifle:{name:_("rifle"),type:"weapon",buildMsg:_("black powder and bullets, like the old days."),cost:function(){return{wood:200,steel:50,sulphur:50}},audio:AudioLibrary.CRAFT_RIFLE}},TradeGoods:{scales:{type:"good",cost:function(){return{fur:150}},audio:AudioLibrary.BUY_SCALES},teeth:{type:"good",cost:function(){return{fur:300}},audio:AudioLibrary.BUY_TEETH},iron:{type:"good",cost:function(){return{fur:150,scales:50}},audio:AudioLibrary.BUY_IRON},coal:{type:"good",cost:function(){return{fur:200,teeth:50}},audio:AudioLibrary.BUY_COAL},steel:{type:"good",cost:function(){return{fur:300,scales:50,teeth:50}},audio:AudioLibrary.BUY_STEEL},medicine:{type:"good",cost:function(){return{scales:50,teeth:30}},audio:AudioLibrary.BUY_MEDICINE},bullets:{type:"good",cost:function(){return{scales:10}},audio:AudioLibrary.BUY_BULLETS},"energy cell":{type:"good",cost:function(){return{scales:10,teeth:10}},audio:AudioLibrary.BUY_ENERGY_CELL},bolas:{type:"weapon",cost:function(){return{teeth:10}},audio:AudioLibrary.BUY_BOLAS},grenade:{type:"weapon",cost:function(){return{scales:100,teeth:50}},audio:AudioLibrary.BUY_GRENADES},bayonet:{type:"weapon",cost:function(){return{scales:500,teeth:250}},audio:AudioLibrary.BUY_BAYONET},"alien alloy":{type:"good",cost:function(){return{fur:1500,scales:750,teeth:300}},audio:AudioLibrary.BUY_ALIEN_ALLOY},compass:{type:"special",maximum:1,cost:function(){return{fur:400,scales:20,teeth:10}},audio:AudioLibrary.BUY_COMPASS}},MiscItems:{"laser rifle":{type:"weapon"}},name:_("Room"),init:function(e){this.options=$.extend(this.options,e),Room.pathDiscovery=Boolean($SM.get('stores["compass"]')),Engine._debug&&(this._ROOM_WARM_DELAY=5e3,this._BUILDER_STATE_DELAY=5e3,this._STOKE_COOLDOWN=0,this._NEED_WOOD_DELAY=5e3),void 0===$SM.get("features.location.room")&&($SM.set("features.location.room",!0),$SM.set("game.builder.level",-1)),$SM.set("game.temperature",void 0===$SM.get("game.temperature.value")?this.TempEnum.Freezing:$SM.get("game.temperature")),$SM.set("game.fire",void 0===$SM.get("game.fire.value")?this.FireEnum.Dead:$SM.get("game.fire")),this.tab=Header.addLocation(_("A Dark Room"),"room",Room),this.panel=$("<div>").attr("id","roomPanel").addClass("location").appendTo("div#locationSlider"),Engine.updateSlider(),new Button.Button({id:"lightButton",text:_("light fire"),click:Room.lightFire,cooldown:Room._STOKE_COOLDOWN,width:"80px",cost:{wood:5}}).appendTo("div#roomPanel"),new Button.Button({id:"stokeButton",text:_("stoke fire"),click:Room.stokeFire,cooldown:Room._STOKE_COOLDOWN,width:"80px",cost:{wood:1}}).appendTo("div#roomPanel"),$("<div>").attr("id","storesContainer").prependTo("div#roomPanel"),$.Dispatch("stateUpdate").subscribe(Room.handleStateUpdates),Room.updateButton(),Room.updateStoresView(),Room.updateIncomeView(),Room.updateBuildButtons(),Room._fireTimer=Engine.setTimeout(Room.coolFire,Room._FIRE_COOL_DELAY),Room._tempTimer=Engine.setTimeout(Room.adjustTemp,Room._ROOM_WARM_DELAY),$SM.get("game.builder.level")>=0&&$SM.get("game.builder.level")<3&&(Room._builderTimer=Engine.setTimeout(Room.updateBuilderState,Room._BUILDER_STATE_DELAY)),1==$SM.get("game.builder.level")&&$SM.get("stores.wood",!0)<0&&Engine.setTimeout(Room.unlockForest,Room._NEED_WOOD_DELAY),Engine.setTimeout($SM.collectIncome,1e3),Notifications.notify(Room,_("the room is {0}",Room.TempEnum.fromInt($SM.get("game.temperature.value")).text)),Notifications.notify(Room,_("the fire is {0}",Room.FireEnum.fromInt($SM.get("game.fire.value")).text))},options:{},onArrival:function(e){Room.setTitle(),Room.changed&&(Notifications.notify(Room,_("the fire is {0}",Room.FireEnum.fromInt($SM.get("game.fire.value")).text)),Notifications.notify(Room,_("the room is {0}",Room.TempEnum.fromInt($SM.get("game.temperature.value")).text)),Room.changed=!1),3==$SM.get("game.builder.level")&&($SM.add("game.builder.level",1),$SM.setIncome("builder",{delay:10,stores:{wood:2}}),Room.updateIncomeView(),Notifications.notify(Room,_("the stranger is standing by the fire. she says she can help. says she builds things."))),Engine.moveStoresView(null,e),Room.setMusic()},TempEnum:{fromInt:function(e){for(var o in this)if(void 0!==this[o].value&&this[o].value==e)return this[o];return null},Freezing:{value:0,text:_("freezing")},Cold:{value:1,text:_("cold")},Mild:{value:2,text:_("mild")},Warm:{value:3,text:_("warm")},Hot:{value:4,text:_("hot")}},FireEnum:{fromInt:function(e){for(var o in this)if(void 0!==this[o].value&&this[o].value==e)return this[o];return null},Dead:{value:0,text:_("dead")},Smoldering:{value:1,text:_("smoldering")},Flickering:{value:2,text:_("flickering")},Burning:{value:3,text:_("burning")},Roaring:{value:4,text:_("roaring")}},setTitle:function(){var e=$SM.get("game.fire.value")<2?_("A Dark Room"):_("A Firelit Room");Engine.activeModule==this&&(document.title=e),$("div#location_room").text(e)},updateButton:function(){var e=$("#lightButton.button"),o=$("#stokeButton.button");$SM.get("game.fire.value")==Room.FireEnum.Dead.value&&"none"!=o.css("display")?(o.hide(),e.show(),o.hasClass("disabled")&&Button.cooldown(e)):"none"!=e.css("display")&&(o.show(),e.hide(),e.hasClass("disabled")&&Button.cooldown(o)),$SM.get("stores.wood")?(e.removeClass("free"),o.removeClass("free")):(e.addClass("free"),o.addClass("free"))},_fireTimer:null,_tempTimer:null,lightFire:function(){var e=$SM.get("stores.wood");if(e<5)return Notifications.notify(Room,_("not enough wood to get the fire going")),void Button.clearCooldown($("#lightButton.button"));e>4&&$SM.set("stores.wood",e-5),$SM.set("game.fire",Room.FireEnum.Burning),AudioEngine.playSound(AudioLibrary.LIGHT_FIRE),Room.onFireChange()},stokeFire:function(){var e=$SM.get("stores.wood");if(0===e)return Notifications.notify(Room,_("the wood has run out")),void Button.clearCooldown($("#stokeButton.button"));e>0&&$SM.set("stores.wood",e-1),$SM.get("game.fire.value")<4&&$SM.set("game.fire",Room.FireEnum.fromInt($SM.get("game.fire.value")+1)),AudioEngine.playSound(AudioLibrary.STOKE_FIRE),Room.onFireChange()},onFireChange:function(){Engine.activeModule!=Room&&(Room.changed=!0),Notifications.notify(Room,_("the fire is {0}",Room.FireEnum.fromInt($SM.get("game.fire.value")).text),!0),$SM.get("game.fire.value")>1&&$SM.get("game.builder.level")<0&&($SM.set("game.builder.level",0),Notifications.notify(Room,_("the light from the fire spills from the windows, out into the dark")),Engine.setTimeout(Room.updateBuilderState,Room._BUILDER_STATE_DELAY)),window.clearTimeout(Room._fireTimer),Room._fireTimer=Engine.setTimeout(Room.coolFire,Room._FIRE_COOL_DELAY),Room.updateButton(),Room.setTitle(),Engine.activeModule==Room&&Room.setMusic()},coolFire:function(){var e=$SM.get("stores.wood");$SM.get("game.fire.value")<=Room.FireEnum.Flickering.value&&$SM.get("game.builder.level")>3&&e>0&&(Notifications.notify(Room,_("builder stokes the fire"),!0),$SM.set("stores.wood",e-1),$SM.set("game.fire",Room.FireEnum.fromInt($SM.get("game.fire.value")+1))),$SM.get("game.fire.value")>0&&($SM.set("game.fire",Room.FireEnum.fromInt($SM.get("game.fire.value")-1)),Room._fireTimer=Engine.setTimeout(Room.coolFire,Room._FIRE_COOL_DELAY),Room.onFireChange())},adjustTemp:function(){var e=$SM.get("game.temperature.value");$SM.get("game.temperature.value")>0&&$SM.get("game.temperature.value")>$SM.get("game.fire.value")&&($SM.set("game.temperature",Room.TempEnum.fromInt($SM.get("game.temperature.value")-1)),Notifications.notify(Room,_("the room is {0}",Room.TempEnum.fromInt($SM.get("game.temperature.value")).text),!0)),$SM.get("game.temperature.value")<4&&$SM.get("game.temperature.value")<$SM.get("game.fire.value")&&($SM.set("game.temperature",Room.TempEnum.fromInt($SM.get("game.temperature.value")+1)),Notifications.notify(Room,_("the room is {0}",Room.TempEnum.fromInt($SM.get("game.temperature.value")).text),!0)),$SM.get("game.temperature.value")!=e&&(Room.changed=!0),Room._tempTimer=Engine.setTimeout(Room.adjustTemp,Room._ROOM_WARM_DELAY)},unlockForest:function(){$SM.set("stores.wood",4),Outside.init(),Notifications.notify(Room,_("the wind howls outside")),Notifications.notify(Room,_("the wood is running out")),Engine.event("progress","outside")},updateBuilderState:function(){var e=$SM.get("game.builder.level");if(0===e)Notifications.notify(Room,_("a ragged stranger stumbles through the door and collapses in the corner")),e=$SM.setget("game.builder.level",1),Engine.setTimeout(Room.unlockForest,Room._NEED_WOOD_DELAY);else if(e<3&&$SM.get("game.temperature.value")>=Room.TempEnum.Warm.value){var o="";switch(e){case 1:o=_("the stranger shivers, and mumbles quietly. her words are unintelligible.");break;case 2:o=_("the stranger in the corner stops shivering. her breathing calms.")}Notifications.notify(Room,o),e<3&&(e=$SM.setget("game.builder.level",e+1))}e<3&&Engine.setTimeout(Room.updateBuilderState,Room._BUILDER_STATE_DELAY),Engine.saveGame()},updateStoresView:function(){var e=$("div#stores"),o=$("div#resources"),t=$("div#special"),i=$("div#weapons"),a=!1,r=!1,n=!1,s=!1,u=!1;for(var d in 0===e.length&&(e=$("<div>").attr({id:"stores","data-legend":_("stores")}).css("opacity",0),a=!0),0===o.length&&(o=$("<div>").attr({id:"resources"}).css("opacity",0),r=!0),0===t.length&&(t=$("<div>").attr({id:"special"}).css("opacity",0),n=!0),0===i.length&&(i=$("<div>").attr({id:"weapons","data-legend":_("weapons")}).css("opacity",0),s=!0),$SM.get("stores")){if(d.indexOf("blueprint")>0)continue;const e=Room.Craftables[d]||Room.TradeGoods[d]||Room.TradeGoods[d]||Room.MiscItems[d]||Fabricator.Craftables[d];var l;switch(e?e.type:null){case"upgrade":case"building":continue;case"weapon":l=i;break;case"special":l=t;break;default:l=o}var m="row_"+d.replace(/ /g,"-"),g=$("div#"+m,l),c=$SM.get('stores["'+d+'"]');("number"!=typeof c||isNaN(c))&&(c=0,$SM.set('stores["'+d+'"]',0));var p=_(d);if(void 0===$SM.get("game.thieves")&&c>5e3&&$SM.get("features.location.world")&&$SM.startThieves(),0===g.length){g=$("<div>").attr("id",m).addClass("storeRow"),$("<div>").addClass("row_key").text(p).appendTo(g),$("<div>").addClass("row_val").text(Math.floor(c)).appendTo(g),$("<div>").addClass("clear").appendTo(g);var f=null;l.children().each((function(e){var o=$(this);o.children(".row_key").text()<p&&(f=o.attr("id"))})),null==f?g.prependTo(l):g.insertAfter(l.find("#"+f)),u=!0}else $("div#"+g.attr("id")+" > div.row_val",l).text(Math.floor(c))}r&&o.children().length>0&&(o.prependTo(e),o.animate({opacity:1},300,"linear")),n&&t.children().length>0&&(t.appendTo(e),t.animate({opacity:1},300,"linear")),a&&e.find("div.storeRow").length>0&&(e.appendTo("div#storesContainer"),e.animate({opacity:1},300,"linear")),s&&i.children().length>0&&(i.appendTo("div#storesContainer"),i.animate({opacity:1},300,"linear")),u&&Room.updateIncomeView(),$("div#outsidePanel").length&&Outside.updateVillage(),$SM.get("stores.compass")&&!Room.pathDiscovery&&(Room.pathDiscovery=!0,Path.openPath())},updateIncomeView:function(){var e=$("div#resources"),o={};0!==e.length&&void 0!==$SM.get("income")&&$("div.storeRow",e).each((function(e,t){t=$(t),$("div.tooltip",t).remove();var i=e>10?"top right":"bottom right",a=$("<div>").addClass("tooltip "+i),r=t.attr("id").substring(4).replace("-"," ");for(var n in $SM.get("income")){var s=$SM.get('income["'+n+'"]');for(var u in s.stores)u==r&&0!==s.stores[u]&&($("<div>").addClass("row_key").text(_(n)).appendTo(a),$("<div>").addClass("row_val").text(Engine.getIncomeMsg(s.stores[u],s.delay)).appendTo(a),o[u]&&void 0!==o[u].income||(o[u]={income:0}),o[u].income+=Number(s.stores[u]),o[u].delay=s.delay)}if(a.children().length>0){var d=o[r].income;$("<div>").addClass("total row_key").text(_("total")).appendTo(a),$("<div>").addClass("total row_val").text(Engine.getIncomeMsg(d,o[r].delay)).appendTo(a),a.appendTo(t)}}))},buy:function(e){var o=$(e).attr("buildThing"),t=Room.TradeGoods[o],i=$SM.get('stores["'+o+'"]',!0);if(i<0&&(i=0),!(t.maximum<=i)){var a={},r=t.cost();for(var n in r){var s=$SM.get('stores["'+n+'"]',!0);if(s<r[n])return Notifications.notify(Room,_("not enough "+n)),!1;a[n]=s-r[n]}$SM.setM("stores",a),Notifications.notify(Room,t.buildMsg),$SM.add('stores["'+o+'"]',1),AudioEngine.playSound(AudioLibrary.BUY)}},build:function(e){var o=$(e).attr("buildThing");if($SM.get("game.temperature.value")<=Room.TempEnum.Cold.value)return Notifications.notify(Room,_("builder just shivers")),!1;var t=Room.Craftables[o],i=0;switch(t.type){case"good":case"weapon":case"tool":case"upgrade":i=$SM.get('stores["'+o+'"]',!0);break;case"building":i=$SM.get('game.buildings["'+o+'"]',!0)}if(i<0&&(i=0),!(t.maximum<=i)){var a={},r=t.cost();for(var n in r){var s=$SM.get('stores["'+n+'"]',!0);if(s<r[n])return Notifications.notify(Room,_("not enough "+n)),!1;a[n]=s-r[n]}switch($SM.setM("stores",a),Notifications.notify(Room,t.buildMsg),t.type){case"good":case"weapon":case"upgrade":case"tool":$SM.add('stores["'+o+'"]',1);break;case"building":$SM.add('game.buildings["'+o+'"]',1)}switch(t.type){case"weapon":case"upgrade":case"tool":AudioEngine.playSound(AudioLibrary.CRAFT);break;case"building":AudioEngine.playSound(AudioLibrary.BUILD)}}},needsWorkshop:function(e){return"weapon"==e||"upgrade"==e||"tool"==e},craftUnlocked:function(e){if(Room.buttons[e])return!0;if($SM.get("game.builder.level")<4)return!1;var o=Room.Craftables[e];if(Room.needsWorkshop(o.type)&&0===$SM.get('game.buildings["workshop"]',!0))return!1;var t=o.cost();if($SM.get('game.buildings["'+e+'"]')>0)return Room.buttons[e]=!0,!0;if($SM.get("stores.wood",!0)<.5*t.wood)return!1;for(var i in t)if(!$SM.get('stores["'+i+'"]'))return!1;return Room.buttons[e]=!0,$SM.get('game.buildings["'+e+'"]')||Notifications.notify(Room,o.availableMsg),!0},buyUnlocked:function(e){return!!Room.buttons[e]||$SM.get('game.buildings["trading post"]',!0)>0&&("compass"==e||void 0!==$SM.get('stores["'+e+'"]'))},updateBuildButtons:function(){var e=$("#buildBtns"),o=!1;0===e.length&&(e=$("<div>").attr({id:"buildBtns","data-legend":_("build:")}).css("opacity",0),o=!0);var t=$("#craftBtns"),i=!1;0===t.length&&$SM.get('game.buildings["workshop"]',!0)>0&&(t=$("<div>").attr({id:"craftBtns","data-legend":_("craft:")}).css("opacity",0),i=!0);var a=$("#buyBtns"),r=!1;for(var n in 0===a.length&&$SM.get('game.buildings["trading post"]',!0)>0&&(a=$("<div>").attr({id:"buyBtns","data-legend":_("buy:")}).css("opacity",0),r=!0),Room.Craftables){craftable=Room.Craftables[n];var s=$SM.num(n,craftable)+1>craftable.maximum;if(null==craftable.button){if(Room.craftUnlocked(n)){var u=Room.needsWorkshop(craftable.type)?t:e;craftable.button=new Button.Button({id:"build_"+n.replace(/ /g,"-"),cost:craftable.cost(),text:_(n),click:Room.build,width:"80px",ttPos:u.children().length>10?"top right":"bottom right"}).css("opacity",0).attr("buildThing",n).appendTo(u).animate({opacity:1},300,"linear")}}else{var d=$(".tooltip",craftable.button);d.empty();var l=craftable.cost();for(var m in l)$("<div>").addClass("row_key").text(_(m)).appendTo(d),$("<div>").addClass("row_val").text(l[m]).appendTo(d);s&&!craftable.button.hasClass("disabled")&&Notifications.notify(Room,craftable.maxMsg)}s?Button.setDisabled(craftable.button,!0):Button.setDisabled(craftable.button,!1)}for(var g in Room.TradeGoods){good=Room.TradeGoods[g];var c=$SM.num(g,good)+1>good.maximum;if(null==good.button)Room.buyUnlocked(g)&&(good.button=new Button.Button({id:"build_"+g,cost:good.cost(),text:_(g),click:Room.buy,width:"80px",ttPos:a.children().length>10?"top right":"bottom right"}).css("opacity",0).attr("buildThing",g).appendTo(a).animate({opacity:1},300,"linear"));else{var p=$(".tooltip",good.button);p.empty();var f=good.cost();for(var b in f)$("<div>").addClass("row_key").text(_(b)).appendTo(p),$("<div>").addClass("row_val").text(f[b]).appendTo(p);c&&!good.button.hasClass("disabled")&&Notifications.notify(Room,good.maxMsg)}c?Button.setDisabled(good.button,!0):Button.setDisabled(good.button,!1)}o&&e.children().length>0&&e.appendTo("div#roomPanel").animate({opacity:1},300,"linear"),i&&t.children().length>0&&t.appendTo("div#roomPanel").animate({opacity:1},300,"linear"),r&&e.children().length>0&&a.appendTo("div#roomPanel").animate({opacity:1},300,"linear")},compassTooltip:function(e){var o=$("div#resources").children().length>10?"top right":"bottom right",t=$("<div>").addClass("tooltip "+o);$("<div>").addClass("row_key").text(_("the compass points "+e)).appendTo(t),t.appendTo($("#row_compass"))},handleStateUpdates:function(e){"stores"==e.category?(Room.updateStoresView(),Room.updateBuildButtons()):"income"==e.category?(Room.updateStoresView(),Room.updateIncomeView()):0===e.stateName.indexOf("game.buildings")&&Room.updateBuildButtons()},setMusic(){switch($SM.get("game.fire.value")){case 0:AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_FIRE_DEAD);break;case 1:AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_FIRE_SMOLDERING);break;case 2:AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_FIRE_FLICKERING);break;case 3:AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_FIRE_BURNING);break;case 4:AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_FIRE_ROARING)}}};