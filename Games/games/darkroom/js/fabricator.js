const Fabricator={_STORES_OFFSET:0,name:_("Fabricator"),Craftables:{"energy blade":{name:_("energy blade"),type:"weapon",buildMsg:_("the blade hums, charged particles sparking and fizzing."),cost:()=>({"alien alloy":1})},"fluid recycler":{name:_("fluid recycler"),type:"upgrade",maximum:1,buildMsg:_("water out, water in. waste not, want not."),cost:()=>({"alien alloy":2})},"cargo drone":{name:_("cargo drone"),type:"upgrade",maximum:1,buildMsg:_("the workhorse of the wanderer fleet."),cost:()=>({"alien alloy":2})},"kinetic armour":{name:_("kinetic armour"),type:"upgrade",maximum:1,blueprintRequired:!0,buildMsg:_("wanderer soldiers succeed by subverting the enemy's rage."),cost:()=>({"alien alloy":2})},disruptor:{name:_("disruptor"),type:"weapon",blueprintRequired:!0,buildMsg:_("somtimes it is best not to fight."),cost:()=>({"alien alloy":1})},hypo:{name:_("hypo"),type:"tool",blueprintRequired:!0,buildMsg:_("a handful of hypos. life in a vial."),cost:()=>({"alien alloy":1}),quantity:5},stim:{name:_("stim"),type:"tool",blueprintRequired:!0,buildMsg:_("sometimes it is best to fight without restraint."),cost:()=>({"alien alloy":1})},"plasma rifle":{name:_("plasma rifle"),type:"weapon",blueprintRequired:!0,buildMsg:_("the peak of wanderer weapons technology, sleek and deadly."),cost:()=>({"alien alloy":1})},glowstone:{name:_("glow stone"),type:"tool",blueprintRequired:!0,buildMsg:_("a smooth, perfect sphere. its light is inextinguishable."),cost:()=>({"alien alloy":1})}},init:()=>{$SM.get("features.location.fabricator")||$SM.set("features.location.fabricator",!0),Fabricator.tab=Header.addLocation(_("A Whirring Fabricator"),"fabricator",Fabricator,"ship"),Fabricator.panel=$("<div>").attr("id","fabricatorPanel").addClass("location"),Ship.panel?Fabricator.panel.insertBefore(Ship.panel):Fabricator.panel.appendTo("div#locationSlider"),$.Dispatch("stateUpdate").subscribe((()=>{Fabricator.updateBuildButtons(),Fabricator.updateBlueprints()})),Engine.updateSlider(),Fabricator.updateBuildButtons()},onArrival:t=>{Fabricator.setTitle(),Fabricator.updateBlueprints(!0),$SM.get("game.fabricator.seen")||(Notifications.notify(Fabricator,_("the familiar hum of wanderer machinery coming to life. finally, real tools.")),$SM.set("game.fabricator.seen",!0)),AudioEngine.playBackgroundMusic(AudioLibrary.MUSIC_SHIP),Engine.moveStoresView(null,t)},setTitle:()=>{Engine.activeModule==Fabricator&&(document.title=_("A Whirring Fabricator"))},updateBuildButtons:()=>{let t=$("#fabricateButtons"),e=!1;0===t.length&&(t=$("<div>").attr({id:"fabricateButtons","data-legend":_("fabricate:")}).css("opacity",0),e=!0);for(const[e,a]of Object.entries(Fabricator.Craftables)){const i=$SM.num(e,a)+1>a.maximum;if(a.button){const t=$(".tooltip",a.button);t.empty();const e=a.cost();for(const[a,i]of Object.entries(e))$("<div>").addClass("row_key").text(_(a)).appendTo(t),$("<div>").addClass("row_val").text(i).appendTo(t);i&&a.maxMsg&&!a.button.hasClass("disabled")&&Notifications.notify(Fabricator,a.maxMsg)}else if(Fabricator.canFabricate(e)){const i=_(a.name)+((a.quantity??1)>1?` (x${a.quantity})`:"");a.button=new Button.Button({id:"fabricate_"+e,cost:a.cost(),text:i,click:Fabricator.fabricate,width:"150px",ttPos:t.children().length>10?"top right":"bottom right"}).css("opacity",0).attr("fabricateThing",e).appendTo(t).animate({opacity:1},300,"linear")}i?Button.setDisabled(a.button,!0):Button.setDisabled(a.button,!1)}e&&t.children().length>0&&t.appendTo(Fabricator.panel).animate({opacity:1},300,"linear")},updateBlueprints:t=>{if(!$SM.get("character.blueprints"))return;let e=$("#blueprints"),a=!1;0===e.length&&(a=!0,e=$("<div>").attr({id:"blueprints","data-legend":_("blueprints")}));for(const t in $SM.get("character.blueprints")){const a="blueprint_"+t.replace(/ /g,"-");let i=$("#"+a);$SM.get(`character.blueprints["${t}"]`)&&0===i.length&&(i=$("<div>").attr("id",a).addClass("blueprintRow").appendTo(e),$("<div>").addClass("row_key").text(_(t)).appendTo(i))}a&&e.children().length>0&&e.prependTo(Fabricator.panel)},canFabricate:t=>!Fabricator.Craftables[t].blueprintRequired||$SM.get(`character.blueprints['${t}']`),fabricate:t=>{const e=$(t).attr("fabricateThing"),a=Fabricator.Craftables[e],i=Math.min(0,$SM.get(`stores['${e}']`,!0));if(a.maximum<=i)return;const r={},o=a.cost();for(const[t,e]of Object.entries(o)){const a=$SM.get(`stores['${t}']`,!0);if(a<e)return Notifications.notify(Fabricator,_(`not enough ${t}`)),!1;r[t]=a-e}$SM.setM("stores",r),$SM.add(`stores['${e}']`,a.quantity??1),Notifications.notify(Fabricator,a.buildMsg),AudioEngine.playSound(AudioLibrary.CRAFT)}};